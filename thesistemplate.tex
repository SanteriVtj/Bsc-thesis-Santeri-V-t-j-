%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                %%
%% An example for writting your thesis using LaTeX                %%
%% Original version by Luis Costa,  changes by Perttu Puska       %%
%% Support for Swedish added 15092014                             %%
%%                                                                %%
%% This example consists of the files                             %%
%%         thesistemplate.tex (versio 2.01)                       %%
%%         opinnaytepohja.tex (versio 2.01) (for text in Finnish) %%
%%         aaltothesis.cls (versio 2.01)                          %%
%%         kuva1.eps                                              %%
%%         kuva2.eps                                              %%
%%         kuva1.pdf                                              %%
%%         kuva2.pdf                                              %%
%%                                                                %%
%%                                                                %%
%% Typeset either with                                            %%
%% latex:                                                         %%
%%             $ latex opinnaytepohja                             %%
%%             $ latex opinnaytepohja                             %%
%%                                                                %%
%%   Result is the file opinnayte.dvi, which                      %%
%%   is converted to ps format as follows:                        %%
%%                                                                %%
%%             $ dvips opinnaytepohja -o                          %%
%%                                                                %%
%%   and then to pdf as follows:                                  %%
%%                                                                %%
%%             $ ps2pdf opinnaytepohja.ps                         %%
%%                                                                %%
%% Or                                                             %%
%% pdflatex:                                                      %%
%%             $ pdflatex opinnaytepohja                          %%
%%             $ pdflatex opinnaytepohja                          %%
%%                                                                %%
%%   Result is the file opinnaytepohja.pdf                        %%
%%                                                                %%
%% Explanatory comments in this example begin with                %%
%% the characters %%, and changes that the user can make          %%
%% with the character %                                           %%
%%                                                                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Uncomment one of these:
%% the 1st when using pdflatex, which directly typesets your document in
%% pdf (use jpg or pdf figures), or
%% the 2nd when producing a ps file (use eps figures, don't use ps figures!).
\documentclass[main=english,12pt,a4paper,pdftex,econ,utf8]{aaltothesis}
\usepackage{comment}
\usepackage{caption}
\usepackage{capt-of}
%\documentclass[english,12pt,a4paper,dvips]{aaltothesis}

%% To the \documentclass above
%% specify your school: arts, biz, chem, elec, eng, sci, econ
%% specify the character encoding scheme used by your editor: utf8, latin1

%% Use one of these if you write in Finnish (see the Finnish template):
%%
%\documentclass[finnish,12pt,a4paper,pdftex,elec,utf8]{aaltothesis}
%\documentclass[finnish,12pt,a4paper,dvips]{aaltothesis}

\usepackage{graphicx}

%% Use this if you write hard core mathematics, these are usually needed
\usepackage{amsfonts,amssymb,amsbsy,amsmath,bm}
\usepackage{color, soul}
\usepackage{pst-node, auto-pst-pdf}
\usepackage{enumerate}
%% Use the macros in this package to change how the hyperref package below 
%% typesets its hypertext -- hyperlink colour, font, etc. See the package
%% documentation. It also defines the \url macro, so use the package when 
%% not using the hyperref package.
%%
%\usepackage{url}

%% Use this if you want to get links and nice output. Works well with pdflatex.
\usepackage{tikz}
\usepackage{verbatim}
\usepackage{forest}
\usepackage{etoolbox}
\usetikzlibrary{arrows,trees,positioning}
\tikzstyle{circleobject}=[circle,fill=white,draw,line width=0.5mm]
\tikzstyle{line}=[draw]
\tikzstyle{arrow}=[draw, -latex]


\tikzset{%
    /forest,
    forest node/.style={circle, inner sep=0pt, text centered},
    arn n/.append style={text=white, font=\sffamily\bfseries, draw=black, text width=1.5em},
    arn r/.append style={text=red, draw=red, text width=1.5em, very thick},
  }
\usepackage{hyperref}
\usepackage{csquotes}
\hypersetup{
    pdfpagemode=UseNone, 
    colorlinks=true,
    filecolor=blue,
    pdfstartview=FitH,
    urlcolor=blue,
    linkcolor=red,
    citecolor=black,
    pdftitle={Default Title, Modify},
    pdfauthor={Your Name},
    pdfkeywords={Modify keywords},
    urlcolor=blue
}

\usepackage[
    backend=biber,
    sorting=nyt,
    style=authoryear
]{biblatex}
\addbibresource{library.bib}
\addbibresource{manual.bib}
\linespread{1.5}
%----------------- NEW COMMANDS -----------------
\newcommand{\indep}{\perp \!\!\! \perp}
\newcommand{\nindep}{\not\!\indep}
\newcommand{\dsep}{\stackrel{d}{\indep}}
\let\emptyset\varnothing
\newcommand{\ch}[1]{Ch(#1)}
\newcommand{\pa}[1]{Pa(#1)}
\newcommand{\de}[1]{De(#1)}
\newcommand{\z}{\mathcal{Z}}
\newcommand{\g}{\mathcal{G}}
\newcommand{\e}{\bm{\epsilon}}
\newcommand{\vars}{\bm{V}}
\newcommand{\unobs}{\bm{U}}
\newcommand{\wrap}[1]{\parbox{.33\linewidth}{\vspace{1.5mm}#1\vspace{1mm}}}
\DeclareCaptionType{lcaption}[List][List of things]
%------------------------------------------------
%% All that is printed on paper starts here
\begin{document}

%% Change the school field to specify your school if the automatically 
%% set name is wrong
% \university{aalto-yliopisto}
% \university{aalto University}
% \school{Sähkötekniikan korkeakoulu}
% \school{School of Electrical Engineering}

%% Only for B.Sc. thesis: Choose your degree programme. 
\degreeprogram{Bachelor's Programme in Economics}
%%

%% ONLY FOR M.Sc. AND LICENTIATE THESIS: Specify your department,
%% professorship and professorship code. 
%%
\department{Department of Economics}
%\professorship{Circuit theory}
%%

%% Valitse yksi näistä kolmesta
%%
%% Choose one of these:
\univdegree{BSc}
%\univdegree{MSc}
%\univdegree{Lic}



%% Your own name (should be self explanatory...)
\author{Santeri Väätäjä}

%% Your thesis title comes here and again before a possible abstract in
%% Finnish or Swedish . If the title is very long and latex does an
%% unsatisfactory job of breaking the lines, you will have to force a
%% linebreak with the \\ control character. 
%% Do not hyphenate titles.
%% 
\thesistitle{\mbox{Directed acyclic graph causal inference framework} and its applications in econometrics}

\place{Espoo}

%% For B.Sc. thesis use the date when you present your thesis. 
%% 
%% Kandidaatintyön päivämäärä on sen esityspäivämäärä! 
\date{24.8.2021}

%% B.Sc. or M.Sc. thesis supervisor 
%% Note the "\" after the comma. This forces the following space to be 
%% a normal interword space, not the space that starts a new sentence. 
%% This is done because the fullstop isn't the end of the sentence that
%% should be followed by a slightly longer space but is to be followed
%% by a regular space.
%%
\supervisor{Prof. Pauli Murto} %{Prof.\ Pirjo Professori}

%% B.Sc. or M.Sc. thesis advisors(s). You can give upto two advisors in
%% this template. Check with your supervisor how many official advisors
%% you can have.
%%
%\advisor{Prof.\ Pirjo Professori}
\advisor{Asst. Prof. Ciprian Domnisoru}
%\advisor{M.Sc.\ Polli Pohjaaja}

%% Aalto logo: syntax:
%% \uselogo{aaltoRed|aaltoBlue|aaltoYellow|aaltoGray|aaltoGrayScale}{?|!|''}
%%
%% Logo language is set to be the same as the document language.
%% Logon kieli on sama kuin dokumentin kieli
%%
\uselogo{aaltoRed}{''}

%% Create the coverpage
%%
\makecoverpage


%% Note that when writting your master's thesis in English, place
%% the English abstract first followed by the possible Finnish abstract

%% English abstract.
%% All the information required in the abstract (your name, thesis title, etc.)
%% is used as specified above.
%% Specify keywords
%%
%% Kaikki tiivistelmässä tarvittava tieto (nimesi, työnnimi, jne.) käytetään
%% niin kuin se on yllä määritelty.
%% Avainsanat
%%
\keywords{For keywords choose concepts that are central to your thesis}
%% Abstract text
\begin{abstractpage}[english]
  Your abstract in English. Try to keep the abstract short; approximately 
  100 words should be enough. The abstract explains your research topic, 
  the methods you have used, and the results you obtained.  
  Your abstract in English. Try to keep the abstract short; approximately 
  100 words should be enough. The abstract explains your research topic, 
  the methods you have used, and the results you obtained.  

  Your abstract in English. Try to keep the abstract short; approximately 
  100 words should be enough. The abstract explains your research topic, 
  the methods you have used, and the results you obtained.  
  Your abstract in English. Try to keep the abstract short; approximately 
  100 words should be enough. The abstract explains your research topic, 
  the methods you have used, and the results you obtained.  
\end{abstractpage}

%% Force a new page so that the possible English abstract starts on a new page
%%
%% Pakotetaan uusi sivu varmuuden vuoksi, jotta 
%% mahdollinen suomenkielinen ja englanninkielinen tiivistelmä
%% eivät tule vahingossakaan samalle sivulle
\begin{comment}
\newpage
%
%% Abstract in Finnish.  Delete if you don't need it. 
\thesistitle{Opinnäyteohje}
\advisor{TkT Olli Ohjaaja}
\degreeprogram{Electronics and electrical engineering}
\department{Radiotieteen ja -tekniikan laitos}
\professorship{Piiriteoria}
%% Avainsanat
\keywords{Vastus, Resistanssi,\\ Lämpötila}
%% Tiivistelmän tekstiosa
\begin{abstractpage}[finnish]
  Tiivistelmässä on lyhyt selvitys (noin 100 sanaa)
  kirjoituksen tärkeimmästä sisällöstä: mitä ja miten on tutkittu,
  sekä mitä tuloksia on saatu. 
  Tiivistelmässä on lyhyt selvitys (noin 100 sanaa)
  kirjoituksen tärkeimmästä sisällöstä: mitä ja miten on tutkittu,
  sekä mitä tuloksia on saatu. 

  Tiivistelmässä on lyhyt selvitys (noin 100 sanaa)
  kirjoituksen tärkeimmästä sisällöstä: mitä ja miten on tutkittu,
  sekä mitä tuloksia on saatu. 
  Tiivistelmässä on lyhyt selvitys (noin 100 sanaa)
  kirjoituksen tärkeimmästä sisällöstä: mitä ja miten on tutkittu,
  sekä mitä tuloksia on saatu. 
  Tiivistelmässä on lyhyt selvitys (noin 100 sanaa)
  kirjoituksen tärkeimmästä sisällöstä: mitä ja miten on tutkittu,
  sekä mitä tuloksia on saatu. 
\end{abstractpage}

\end{comment}
%% Force new page so that the Swedish abstract starts from a new page
\newpage
%
%% Swedish abstract. Delete if you don't need it. 
%% 

%% Table of contents.
{
\hypersetup{linkcolor=black}
\thesistableofcontents
}

%% Symbols and abbreviations
\mysection{Symbols and abbreviations}

\subsection*{Symbols}

\begin{tabular}{ll}
$\vars$ & set of vertices $\{V_{1},V_{2},\ldots,V_{N}\}$ \\
$\unobs$ & set of unobserved/exogenous variables $\{U_{1},U_{2},\ldots,U_{N}\}$ \\
$\e$ & set of edges $\{\epsilon_{1},\epsilon_{2},\ldots,\epsilon_{N}\}$ \\
$\emptyset$ & graph with no nodes or vertices \\
$\g$ & graph \\
$\z$ & subset of graph
\begin{comment}
$\mathbf{B}$  & magnetic flux density  \\
$c$              & speed of light in vacuum $\approx 3\times10^8$ [m/s]\\
$\omega_{\mathrm{D}}$    & Debye frequency \\
$\omega_{\mathrm{latt}}$ & average phonon frequency of lattice \\
$\uparrow$       & electron spin direction up\\
$\downarrow$     & electron spin direction down
\end{comment}
\end{tabular}

\subsection*{Operators}

\begin{tabular}{ll}
$\indep$ & independent \\
$\nindep$ & not independent \\
%$\dsep$ & d-separation \\
$\pa{\circ}$ & parents of given node \\
$\ch{\circ}$ & children of given node \\
$\de{\circ}$ & descendants of given node \\
$Pr(\circ)$ & probability
\begin{comment}
$\nabla \times \mathbf{A}$              & curl of vectorin $\mathbf{A}$\\
$\displaystyle\frac{\mbox{d}}{\mbox{d} t}$ & derivative with respect to 
variable $t$\\[3mm]
$\displaystyle\frac{\partial}{\partial t}$  & partial derivative with respect 
to variable $t$ \\[3mm]
$\sum_i $                       & sum over index $i$\\
$\mathbf{A} \cdot \mathbf{B}$    & dot product of vectors $\mathbf{A}$ and 
$\mathbf{B}$
\end{comment}
\end{tabular}

\subsection*{Abbreviations}
\begin{tabular}{ll}
DAG & directed acyclic graph \\
DCG & directed cyclic graph \\
SEM & structural equation model \\
LMC & local Markov condition
\begin{comment}
AC         & alternating current \\
APLAC      & an object-oriented analog circuit simulator and design tool \\
           & (originally Analysis Program for Linear Active Circuits) \\
BCS        & Bardeen-Cooper-Schrieffer \\ %% dash between the names
DC         & direct current \\
TEM        & transverse eletromagnetic
\end{comment}
\end{tabular}


%% Tweaks the page numbering to meet the requirement of the thesis format:
%% Begin the pagenumbering in Arabian numerals (and leave the first page
%% of the text body empty, see \thispagestyle{empty} below).
%% Additionally, force the actual text to begin on a new page with the 
%% \clearpage command.
%% \clearpage is similar to \newpage, but it also flushes the floats (figures
%% and tables).
%% There is no need to change these
%%
\cleardoublepage
\storeinipagenumber
\pagenumbering{arabic}
\setcounter{page}{1}


%% Text body begins. Note that since the text body
%% is mostly in Finnish the majority of comments are
%% also in Finnish after this point. There is no point in explaining
%% Finnish-language specific thesis conventions in English. Someday 
%% this text will possibly be translated to English.
%%
\section{Introduction}
%\section{Introduction}

%% Ensimm\"ainen sivu tyhj\"aksi
%% 
%% Leave first page empty
\thispagestyle{empty}

Declaring causal inference has been for a long time debated area, in social sciences in general, and respectively in economics. It is naturally very interesting for scientists across the fields to establish more profound connections than correlation to events affecting their studies. It also works as a way for economists to have larger effect on society as it enables policy advises to have more solid foundation on the effects of particular policy changes studied and research to identify relations of the particular events that can be interpreted as causal.

This thesis is ment to give an overview on a one of such a methods that can be used to infer causal connections from data. This thesis will especially focus on the issue of how it could be applied in econometric applications specifically and what are the problems there is still to work out for it to be used if at all. The method discussed here, directed acyclic graph (DAG) causal inference, is a method used in multiple fields including computer science and epidemiology, but have had smaller role in social sciences. However in recent years there has been more interest also from these fields for example one of the main advocates of this method and scientist in computer science who have done lots of work with this method, Judea Pear and who --- quite strongly --- feels that DAG methods should be used also in economics (\cite{pearl_2014}) and Guido Imbens an economist have had some conversations over articles (\cite{Imbens2014}) about the suitability of the method in economics and social sciences.

To observe such relation between events that could be interpret as causal, usually some kind of \textit{counterfactual} must be formed, where some alternative reality differing from the observed world in which some of the causal factors have been changed. This is achieved by some model where the outcome is also differing from the observed world and in which we can then study the effects of changing those factors. This is also the case in directed acyclic graph approach. World which is formed in process is of course impossible to observe as it is by definition in someway differing from the existing world to show the different outcome and needs some model that tries to mimic it.

For all social scientists and economists this kind of tools that enable them to induce causal relationships are very useful as they try to identify causes of certain events which might have some implications for choosing optimal policies in level of governments or in smaller units of society like companies. For example \cite{Ji2018} tried to find the factors affecting natural gas prices in the United States. This kind of research, enabled by causal inference, can easily be seen as very useful and in case of energy prices could be used for example to form better mechanisms for example for emissions trading or other market mechanisms. By identifying the causal relations better policy makers have better information in hand to use for their policy decisions. 

However in DAG approach there also exists also many problems that have led to the situation that it is still reasonably rarely used in economic applications and the potential outcome framework with models such as Rubin causal model have been the standard option. Some things that causing problems in econometric uses has been for example the difficulty to implement monotonicity within the DAG framework and which is needed for example when instruments are used for causal inference and overall the lack of advantages of graphical approach in questions that economics is mostly addressing (\cite{Imbens2014}).

\noindent \hl{ROADMAP}

\clearpage

\section{Overview of directed acyclic graphs} \label{section:overview}

\subsection{Directed acyclic graph as structure}

DAGs are at simplest just set containing variables $\vars$ that have some extra restrictions regarding the way nodes are connected withing the graph, but can in principle be any random variables otherwise. These restrictions are defining the set of possible relations for the variables of the graph in hand as well as defining not permitted structures in the topological path. Paths build up from the edges contained in $\e$ which contain the relational information of graph. Edges thus have in case of DAGs property of direction and information on the vertex where it begins as well as where it ends. Edges and directions of a graph are not symmetric relations in case of DAGs since $\e\subseteq V^2\setminus(i,i)$ where $\epsilon_i=(i,j)\neq(j,i)$ which is necessary but not sufficient condition for acyclicity. When the graph is directed it leads to the topological ordering necessarily being proceeding at every point and never having an edge leading backwards in order as Table \ref{tab:topological} shows (\cite{Peters2017}).

\input{topological_ordering}

In this thesis specially directed and acyclic graphs are discussed and thus edges have the direction information, or the information of in which direction each edge can be travelled. Acyclicity means that one vertex cannot exist twice in any possible path. In case vertex would exist twice in path it also could appear infinitely many times in path due to the nature of cycles, which radically reduces the amount of algorithms that can be applied to the graph as well as the assumptions that can be made in the context of the graph that allows the statistical interpretations and thus also prevents the causal inference methods to be used. If there would exist cycles the graph would thus be directed cyclical graph and as such fundamentally non recursive which would break some of the relationships that DAGs have and which will be discussed in more detail later (\cite{Heckman2015}). In other words cyclicity introduces feedback mechanism for the structure which would lead to the graph being recursive and variable within the graph could affect itself. Possibility of causal interpretation under nonrecursive systems, such as  structural equation models (SEM), at all have also been debated withing economics for example by G.S. Maddala (\cite{Maddala1986}) and also defended for example by Pearl (\cite{Pearl1998}).

\subsection{Graph operators}

As graphs have additional conditions defined compared to normal set object there also exists operators that graphs has also defined for them. These operators are also necessary for the causal analysis as these give tools for analyze and define parts of graph differing from the rest.

First concept to know is a path. Path in directed graph consists of variables that have consecutive edges connecting them so that for every variable in path $V_{i}\rightarrow V_{i+1}$, these of course also have role in causal inference as they describe the routes that causal relationships are influencing. Also tightly connected to paths are the colliders, which always exist in relation to the path. Collider of path is structure where aforementioned condition doesn't hold so $V_{i}\rightarrow V_{i-1}$. Example of such can be seen in Table \ref{tab:topological}s DAG where path from $V_{1}$ to $V_{3}$ has path $V_{1}\rightarrow V_{3}$ where no collider exist but the two other paths clearly has colliders as $V_{1}\rightarrow V_{2}\rightarrow V_{4}\rightarrow V_{5}\leftarrow V_{3}$ has $V_{5}$ as collider and $V_{1}\rightarrow V_{2}\rightarrow V_{4}\leftarrow V_{3}$ has $V_{4}$ as collider.

Patch such as $V_{2}\leftarrow V_{1}\rightarrow V_{3}$ in Table \ref{tab:topological} is still further called fork as the middle node has two edges that are emerging from it. Path such as $V_{1}\rightarrow V_{3}\rightarrow V_{5}$ are called chains and in this type of path all edges are parallel.

With paths it is possible define further relations, sometimes called kinship, for vertices in graph. These operators are also needed to analyze the causality in in graphs since those enable distinguishing independencies in graph and to define thus the estimates. Ancestor of variable $V$ in directed graph is such other variable which is appearing before $V$ in topological order and it has direct path to $V$. If vertex is appearing only one edge before $V$ it is called parent node and set of parents is denoted as $\pa{\circ}$. Respectively if there is direct path from $V$ to some other vertex it is called its descendant and it set of descendants is denoted by $\de{\circ}$ and if there is path only one edge long it is children $\ch{\circ}$.

\clearpage

\section{Directed acyclical graphs for statistics and causal inference}

Graphs needs or at least most of the time are used with, some special mathematical machinery when those are applied for causal inference. This section will take an overview to statistical applications of graphs and especially Markovian or causal graphs by going through necessary, most fundamental tools to understand for causal applications of graphical models on conceptual level.

\subsection{D-separation and independency}

D-separation and independency are closely related concepts and in a way overlapping. D-separation is only used in context of graphical models and implies independency within graph between two variables. Variables can be independent in graph by two ways. First one is if the only connecting paths are colliders, since leads two variables being independent without any other conditioning. Second way to establish d-separation is to have ordered pair of variables $(X, Y)$ be separated from each other by set of variables $\z$. Set of variables $\z$ however have few extra conditions for the variables it is contained:

\begin{enumerate}
    \item Variables in $\z$ are variables such that those are middle variables collected from paths that are chains or forks. This would correspond controlling $\{V_{2},V_{3}\}$ or $\{V_{2},V_{4}\}$ in Table \ref{tab:topological} if the exposure variable is $V_{1}$ and outcome variable $V_{5}$.
    \item Variables of $\z$ are not variables or descendants of variables that construct collider on path.
\end{enumerate}

As from above can be seen there can exist multiple efficient{\hypersetup{linkcolor=black}\footnote{Set containing minimum amount of variables that fulfills the conditions for d-separation.}} sets of variable $\z$ even though also conditioning all other variables than colliders or their descendants would also lead to proper d-separation (\cite{Pearl2016}). However by choosing good set of variable to control can also used in advanced in situation where for example measuring some variable would be harder than others. Further, d-separation can help us make testable hypotheses that are implied by the graphical model. This is something setting graphical models apart from other types of causal inference methods and also key part in enabling causal claims from observational data.

\input{independency table}

To have independency with these conditions, model should also be Markovian and fulfill local Markov condition (LMC). Model is Markovian when all of the observable variables or residuals are jointly independent and the model is acyclic. However sometimes some of those unobservables variables are showed in graph and if we know which variables it is effecting i.e. which variables are having some jointly dependent unobservable variables. By including unobservables that are dependent it is still possible to work with model, but the causal claims that can be made have now some extra requirements as those unobservables open up new paths. These kind of models are called semi-Markovian.

Local Markov condition on the other hand is the condition that is needed to provide the independecy by d-separation and thus also translate the graphical properties of a graph to causal claim (\cite{Heckman2015}). LMC is telling us that the variables are independent of other ancestors they have, conditional on their parents. Formally defined LMC is:

\begin{gather} \label{eq:lmc}
    \forall V_{i}\in\vars\text{: }V_{i}\indep\vars\setminus\{\de{V_{i}}\cup \{V_{i}\}\}\,|\,\pa{V_{i}}
\end{gather}

Now with the LMC condition and graphoid statements (\cite{Dawid1979}) that needs to be met to have conditional independency and that Pearl and Paz found out to be met in undirected graphs (\cite{Paz1985}) it gets possible to attach statistical relevance for graphs. Graphoid statements were later also found out to be met in DAGs (\cite{Pearl1986}) which allows the use in this particular graphical approach discussed here.

\subsection{Statistical interpretation of directed acyclical graphs}

From LMC (\ref{eq:lmc}) it is finally possible to derive the general factorization of variables in graphs. As the LMC suggests the parents of node are somewhat special group in context of the probabilistic interpretation by saying that other ancestors than parents are in fact irrelevant for the factorization. To get the conditional distribution for parents of $V_i$ it is possible, from LMC to show that distribution for variables $Pr(V_1,V_2,\ldots,V_n)$ in recursive model with $|\vars|=N$ variables where variables are ordered as $V_1,V_2,\ldots,V_{n-1}$ not being descendants of $V_n$ and $V_{n+1},\ldots,V_{N}$ being descendants of the same variable $V_n$ so that $\pa{V_n}\subseteq V_1,V_2,\ldots,V_{n-1}$ (\cite{Heckman2015}). With this and assumption regarding exogenous variables $\unobs$ to be jointly independent, it is possible to show the conditional independence to be:

\begin{align} \label{eq:factor}
    \begin{split}
        Pr(V_1,V_2,\ldots,V_{n})&=\prod_{V_{n}\in\vars}Pr(V_{n}|V_1,V_2,\ldots,V_{n-1}) \\
        &=\prod_{V_{n}\in\vars}Pr(V_{n}|\pa{V_{n}})
    \end{split}
\end{align}

\noindent With this defined it gets possible to begin giving some meaningful causal interpretations for graphs.

To start making sense of the model with data and having causal interpretation for the relations of functions between nodes those need to be defined. There have been, and is multiple different approaches for this. One of the first approaches was to write SEM with linear equations like $y=\beta x+u$ and then give the causal relation in graph based on the theoretical or observed knowledge of situation (\cite{Wright1921}). This can however be generalized also to non-parametric functions which is for now on, thought to be the default model here. SEM is constructed so that it contains functions for all observed variables (\cite{Pearl2008}), however in model of Table \ref{tab:npmodel} each function contains all of the unobserved variables explicitly wrote to make it a bit more clear even thought those are not shown in the figure.

\input{npmodel}

In this thesis my main focus will be the system developed by Judea Pearl and called \textit{do-calculus}. There exists also other approaches of which to mention system developed by economist James Heckman. His model uses approach, derived from Haavelmos work regarding causal inference (\cite{Haavelmo1943}; \cite{Haavelmo1944}) that is applied to graphs. However Heckmans model differs from the Pearls model, which has been more widely recognized and has more literature regarding both theory and applications, in certain applications but mostly it is way to attain same result with different methods. Important exception from this is instrumental variables which are not possible to identify within the framework Pearl suggests --- without more restrictions that would enable for example monotonicity of functions --- due to its fully non-parametric nature, but which are identifiable with Heckmans hypothetical model, derived from the original DAG. Also the philosophical framework on which causal identifications can be made differs slightly between these approaches.

Pearls approach includes the special notations and tools of do-calculus as he calls it. Do-calculus rules could be thought, to gain some intuition, to be similar in principle to other algebraic notations. By manipulating some expression with unwanted notations, in this case the do-notation, with the rules included in do-calculus we are able to get rid of those and change our expression so that it can be calculated with regular tools of probability theory. Thus it is just set of axioms which are applicable only in context of graph and changes do-statements to regular ordinary probabilities. One of the nice properties of do-calculus is that, originally Pearl only conjectured that only the three rules would be sufficient to find causal connections, but more recently it has been proven that indeed these rules are a complete system for finding causal connections (\cite{Shpitser2006}; \cite{Huang2006}). There are also rules that can be applied with less restrictive rules (\cite{Hyttinen2015}), but these approaches won't probably be as useful with economic applications as they are in machine learning applications, since the idea is to have rules to apply before declaring causal structure.

To get familiar with do-calculus and the identification methods developed for DAGs lets first introduce few new notations. When stating independency as displayed in Table \ref{tab:independency} we might want to give some further conditions under which the independency is realized. If we have graph $\g$ and within that variables $X$, $Y$, $Z$ and $W$ we can use notations such as $\g_{\overline{X}\underline{Z}}$ or $\g_{\overline{XZ(W)}}$. Variable with overline in subscript of graph tells that all of the incoming arrows for this variable are blocked. Respectively with underline it denotes all of the leaving arrows are blocked. When notation is used as done here with $\overline{XZ(W)}$ it denotes all $Z$-nodes, not ancestor of $W$-nodes in $\g_{\overline{X}}$. With these we can now read the do-calculus rules.

\begin{enumerate}
    \item Insertion/deletion rule for observation:
        \begin{gather} \label{eq:do1}
            Pr(y|do(x),z,w)=Pr(y|do(x),w)\text{ if }(Y\indep |X,W)_{\g_{\overline{X}}}
        \end{gather}
    \item Action/observation exchange:
        \begin{gather} \label{eq:do2}
            Pr(y|do(x), do(z), w)=Pr(y|do(x),z,w)\text{ if }(Y\indep Z|X,W)_{\g_{\overline{X}\underline{Z}}}
        \end{gather}
    \item Insertion/deletion of action:
        \begin{gather} \label{eq:do3}
            Pr(y|do(x),do(z),w)=Pr(y|do(x),z,w)\text{ if }(Y\indep Z|X,W)_{\g_{\overline{XZ(W)}}}
        \end{gather}
    \captionof{lcaption}{Do-calculus rules (\cite{Pearl2009a})}
\end{enumerate}

\noindent There exists at least two different formulation of these rules (\cite{Jud1995}; \cite{Pearl2009a}) which of I think these are the clearest and easiest to understand as well as more used in the literature.

The reason why this set of rules exists at the first place is that as graphs have only limited number of identification methods there needs to be something to manipulate graphs towards satisfying those restrictions set for identification. Identification methods can still be applied to graph without any modification in situation where necessary conditions are met. For example graph in \ref{tab:npmodel} is already fulfilling conditions for \textit{the backdoor criterion}.

\begin{itemize}
    \item[] \textbf{The Backdoor Criterion:} In relation to ordered pair $(X,Y)$ in $\g$, set of variables $Z$ satisfies backdoor criterion if no node in $Z$ is a descendant of $X$ and $Z$ blocks all paths between $X$ and $Y$ containing arrow to $X$. When $\g$ satisfies these all of above mentioned criteria, causal effect is attained by backdoor adjustment: \\ 
    (\cite{Pearl2016})
    \begin{align}\label{eq:bd}
        Pr(Y=y|do(X=x))=\sum_{z}Pr(Y=y|X=x,Z=z)Pr(Z=z)
    \end{align}
    With backdoor adjustment also inverse probability could be used with weighting the distribution with $Pr(X=x|Z=z)$.
\end{itemize}

\noindent This identification method can be applied to graph in Table \ref{tab:npmodel} and that will give the causal effect of $X$ to $Y$. In that graph the set of variables is only one variable $\{V_{3}\}$ that needs to be conditioned and by doing so and using the causal effect equation (\ref{eq:bd}) it can be measured as $\sum_{V3}Pr(Y|V3,X)Pr(V3)$ which is giving averaged joint distribution with $V_{3}$ conditioned. Other criteria that could be used and their adjustments are:

\begin{itemize}
    \item[] \textbf{The Frontdoor Criteria:} Set $Z$ satisfy frontdoor criterion relative to $(X,Y)$ when:
    \begin{enumerate}
        \item $Z$ intercepts all of the paths from $X$ to $Y$.
        \item No unblocked paths from $X$ to $Z$.
        \item All backdoor paths from $X$ to $Y$ are blocked by $X$.
    \end{enumerate}
    \vspace{-.2cm}
    (\cite{Pearl2016})
    in this case causal effect can be identified by adjustment formula:
    \begin{align} \label{eq:fd}
        \begin{split}
            Pr(Y&=y|do(X=x)) \\ 
            &=\sum_{z}\sum_{x'}Pr(Y=y|Z=z,X=x')Pr(X=x')Pr(Z=z|X=x)
        \end{split}
    \end{align}
    \item[] \textbf{Z-identification:} $X$, $Y$, $Z$ being disjoint set of variables and $\g$ the causal graph containing those. Causal effect $Q=Pr(y|do(x))$ is $zID$ or z-identifiable in $\g$ if one of next conditions holds: \\
    (\cite{Bareinboim2012})
    \begin{enumerate}
        \item Q is identifiable in $G$ (trivial condition).
        \item There exists $Z'\subseteq Z$ such that next holds:
        \begin{enumerate}[i.]
            \item $X$ intercepts all directed paths from $Z'$ to $Y$.
            \item Q is identifiable in $\g_{\overline{Z'}}$.
        \end{enumerate}
    \end{enumerate}
\end{itemize}

\noindent With these tools we can now understand the basics of identifying causal effects from graphs. Something to mention connected to these methods is that since graphical causal inference methods have largely been developed by computer scientist, there exists rather efficient algorithms to execute each method in practice, of course still bounded with the normal restrictions for algorithmic efficiency related to graphs.

\clearpage

\section{Applications and properties of DAG framework in context of econometric analysis}

\subsection{Existing applications of DAG's in economic literature}

For the most parts economic literature that is using DAG framework as empirical method is concentrated around time series data and modeling for example price drivers or contagion and transmission channels in international trade and financial applications and establishing Granger causality in chosen model (\cite{Awokuse2003}; \cite{Bessler2003}; \cite{Yang2006}). This literature is partly quite old and uses very basic form of DAG framework quite similar to the one discussed before in this thesis. However also some bit more recently published articles exist that covers very similar topics (\cite{Jayech2016}; \cite{Ji2018}) and still with quite  similar methodological setup as those published in the early 2000s. 

So strong representation of time series econometrics in association with DAG's is somewhat surprising considering that time series models are not so much featured in theoretical DAG literature and research considering that is usually more interested other kind of data than economic, or even the kind of data that could necessarily be applied in econometric settings. Interest of theoretical literary is more focused around data where time discretion is less problem, although the problem of those methods can be in solving the problem of discrete measurement frequency which produces only subsample of the real continuous data these models are not very applicable in time series econometrics due to the so much indefinite structures of that data. Those models also trying to establish "instantaneous" or "contemporaneous" relation which are faster than the measurement and differing from the models measuring the transition against the time change of variable or Granger causality that are used in economics (\cite{Hyttinen2017}). Also the Granger causality is problematic as a name for this method as it is not really a causal connection but rather just test of hypothesis with implications of such, rather than causality.

Already mentioned paper of Ji, Zhang and Geng (\cite{Ji2018}) is also example of something where economic researchers have found some use for DAG's. Article considers gas prices but more generally in energy economics there exists some papers like paper from Yang and Zhao \textit{Energy consumption, carbon emissions, and economic growth in India: Evidence from directed acyclic graphs} (\cite{Yang2014}). This paper considers, rather than price information time series data of emissions, energy consumption, capital formation, trade openness and GDP. The basic setup of article is otherwise very similar to other aforementioned articles and the idea is to find the transmission paths that are affecting energy consumption. In this article researchers are also able to find significant Granger causalities between variables like openness of economy, income, maybe a bit less surprisingly energy consumption and pollution.

The way those results are acquired, and the same goes for pretty much all of the articles are other time series econometric significance tests to test Granger causality and then finding the transmissions by DAG. DAG part is for other papers like Selma Jaytech's research on 2011 stock market crash is very straightforward application. It contains basically only the use of PC algorithm (\cite{Spirtes2000}) which is algorithm for identifying the statistically significance edges by having systematically going through those. In principle it works by testing $v_{i}\in\vars$ that each $v_{i}\indep v_{j}$ where $v_{j}\in\{\pa{v_{i}}\cup\ch{v_{i}}\}$ when $i\neq j$ with some statistical test depending on the nature of the nature of variable (e.g. for continuous and discrete different kind of tests are applied) and if so removing the edge between them. Then it goes on with the same setup, but adding conditioned variables one by one as $v_{i}\indep v_{j}|\{v_{1},v_{2},\ldots,v_{n}\}$ when $v_{1},v_{2},\ldots,v_{n}\in\{\vars\setminus\{v_{i}\cup\pa{v_{i}}\cup\ch{v_{i}}\}\}$ and deleting edges if this holds. For other parts the only thing these articles are taking from DAG framework is the basic structure and way to present the structure which is completely comprehensible with the knowledge provided in the section \ref{section:overview} and equation \ref{eq:lmc} provided earlier in thesis.
% $v_{i},v_{j}\not\in\{v_{1},v_{2},\ldots,v_{n}\}$
Also the fact that these are only establishing Granger causality between variables so analysis is just concentrated on correlations and thus none provides any economic usage of the identification tools that are associated with graphs, not to even mention use of do-calculus. Also as it is not intended to measure actual causality these graphs could probably not thought to fulfill the completeness requirement of causal inference in graphs. As an example the Selma Jaytech's paper is only using prince information of stocks and bonds from different countries as determining variables for other countries price variables. It of course could however be adequate model to make complete graph as the international asset markets are not some fully endogenous self defining system, but rather there is some exogenous factors that directs the movements. All of this might very well be sufficient for the purpose of the study, but at the same time it is making these studies, from the standpoint of graphical models and causal inference, not that great of an examples for the use of theoretical framework of DAG causal inference in economics. In other words these papers are using DAG's just as a way to present models visually and the PC algorithm as statistical test for the direction of flow of correlations in time, which makes the model kind of truncated and leaves lot on table for the part of DAG causal inference.

\subsection{Theoretical problems for economic applications}

It seems there isn't necessarily any one major theoretical property that would be a complete deal breaker of the use of DAG's in econometric analysis, and that has not been really the point of those who have been most skeptical on the use of DAG's for econometric causal analysis. Neither do I believe that for example Guido Imbens on his text about \textit{The Book of Why} (\cite{PearlMackenzie18}) is, despite quite critical view on the usefulness of this approach, to say that there would not be any usecases for it in economic literature.

However Imbes, and many of his economist and econometrician colleagues still see many problems in using DAG's that can't be dismissed. Some of the problems are more technical in their nature and some more of a questions of taste and acquire habits like which one of the framework one happens to think is clearer on its notations potential outcomes or DAG's. I will first take  a look on the more technical side of these problems and discuss where DAG approach falls short on techniques used for econometrics and where DAG machinery might be beneficial. It should also be noted that DAG's or at least the formal notations of do-calculus are relatively new techniques and the research regarding those is very active, and some of the problems mentioned here might not be unsolved for very long.



%% Opinn\"aytteess\"a jokainen osa alkaa uudelta sivulta, joten \clearpage
%%
%% In a thesis, every section starts a new page, hence \clearpage
\clearpage

\addcontentsline{toc}{section}{References}
\printbibliography

\end{document}